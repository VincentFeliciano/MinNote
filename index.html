
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brutal Notes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');
      
      body {
        font-family: 'Inter', sans-serif;
        overflow: hidden;
      }

      .brutal-border {
        border: 3px solid black;
      }

      .brutal-shadow {
        box-shadow: 4px 4px 0px 0px rgba(0,0,0,1);
      }

      .brutal-shadow-lg {
        box-shadow: 8px 8px 0px 0px rgba(0,0,0,1);
      }

      .brutal-shadow-active {
        box-shadow: 2px 2px 0px 0px rgba(0,0,0,1);
        transform: translate(2px, 2px);
      }

      .brutal-btn:hover {
        transform: translate(-1px, -1px);
        box-shadow: 6px 6px 0px 0px rgba(0,0,0,1);
      }

      .brutal-btn:active {
        transform: translate(2px, 2px);
        box-shadow: 2px 2px 0px 0px rgba(0,0,0,1);
      }

      /* Grid Background */
      .bg-grid {
        background-size: 30px 30px;
        background-image: radial-gradient(circle, rgba(0,0,0,0.1) 1.5px, transparent 0);
      }

      .dark .bg-grid {
        background-image: radial-gradient(circle, rgba(255,255,255,0.05) 1.5px, transparent 0);
      }

      /* Custom scrollbar - Refined for better spacing */
      ::-webkit-scrollbar {
        width: 10px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
        border-left: 2px solid rgba(0,0,0,0.1);
      }
      ::-webkit-scrollbar-thumb {
        background: black;
        border: 2px solid transparent;
        background-clip: content-box;
      }
      
      .dark ::-webkit-scrollbar-track {
        background: transparent;
        border-left: 2px solid rgba(255,255,255,0.1);
      }
      .dark ::-webkit-scrollbar-thumb {
        background: #00FF41;
      }

      textarea:focus, input:focus {
        outline: none;
      }

      /* Modal Animation */
      @keyframes modal-pop {
        0% { transform: scale(0.9) rotate(-1deg); opacity: 0; }
        100% { transform: scale(1) rotate(0deg); opacity: 1; }
      }
      .modal-animate {
        animation: modal-pop 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
      }
      
      .custom-checkbox {
        appearance: none;
        width: 28px;
        height: 28px;
        border: 3px solid black;
        cursor: pointer;
        position: relative;
        transition: all 0.1s;
        background: white;
      }
      
      .custom-checkbox:checked {
        background: #00FF41;
        box-shadow: 2px 2px 0px 0px black;
      }
      
      .custom-checkbox:checked::after {
        content: 'âœ“';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: black;
        font-weight: 900;
        font-size: 18px;
      }

      /* Ensure vertical only scrolling */
      .scroll-container {
        overflow-y: auto;
        overflow-x: hidden;
      }

      .canvas-container {
        cursor: crosshair;
        touch-action: none;
      }

      /* Audio player styling to match theme */
      audio::-webkit-media-controls-panel {
        background-color: #FFE600;
      }

      /* Hide horizontal scrollbar but keep functionality */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@^19.2.3",
        "react-dom/client": "https://esm.sh/react-dom@^19.2.3/client",
        "lucide-react": "https://esm.sh/lucide-react@^0.475.0"
      }
    }
    </script>
</head>
<body class="transition-colors duration-200">
    <div id="root"></div>

    <script type="module">
      import React, { useState, useEffect, useMemo, useCallback, useRef } from 'react';
      import ReactDOM from 'react-dom/client';
      import { 
        Plus, 
        Search, 
        Moon, 
        Sun, 
        Trash2, 
        ChevronLeft, 
        Menu,
        Clock,
        AlertTriangle,
        Pin,
        PinOff,
        ListTodo,
        Type,
        X,
        CheckCircle2,
        Paperclip,
        Image as ImageIcon,
        Mic,
        Pencil,
        RotateCcw,
        Download,
        Play,
        Square,
        Music,
        FileText
      } from 'lucide-react';

      // Custom Logo Component
      const AppLogo = ({ className }) => (
        React.createElement('svg', { 
          width: "44", 
          height: "62", 
          viewBox: "0 0 44 62", 
          fill: "none", 
          xmlns: "http://www.w3.org/2000/svg",
          className: className
        }, [
          React.createElement('path', { 
            key: "p1",
            d: "M14.0408 8.81818L20.369 28.7102H20.6119L26.9528 8.81818H33.0891L24.0636 35H16.93L7.89169 8.81818H14.0408Z", 
            fill: "currentColor" 
          }),
          React.createElement('path', { 
            key: "p2",
            d: "M42.5 7V58.5L20.5 44L5.5 54M1.5 1.5H39.5V53L20.5 41L1.5 53V1.5Z", 
            stroke: "currentColor", 
            strokeWidth: "3" 
          })
        ])
      );

      const DoodleCanvas = ({ initialData, onSave, theme }) => {
        const canvasRef = useRef(null);
        const [isDrawing, setIsDrawing] = useState(false);
        const ctxRef = useRef(null);
        const savedInitialData = useRef(initialData);

        useEffect(() => {
          const canvas = canvasRef.current;
          canvas.width = canvas.offsetWidth;
          canvas.height = canvas.offsetHeight;
          const ctx = canvas.getContext('2d');
          ctx.lineCap = 'round';
          ctx.lineWidth = 5;
          ctx.strokeStyle = theme === 'dark' ? '#00FF41' : 'black';
          ctxRef.current = ctx;

          if (initialData) {
            const img = new Image();
            img.onload = () => ctx.drawImage(img, 0, 0);
            img.src = initialData;
          }
        }, [theme]); // Re-init context on theme change

        const startDrawing = (e) => {
          const { offsetX, offsetY } = getCoordinates(e);
          ctxRef.current.beginPath();
          ctxRef.current.moveTo(offsetX, offsetY);
          setIsDrawing(true);
        };

        const draw = (e) => {
          if (!isDrawing) return;
          const { offsetX, offsetY } = getCoordinates(e);
          ctxRef.current.lineTo(offsetX, offsetY);
          ctxRef.current.stroke();
        };

        const stopDrawing = () => {
          if (!isDrawing) return;
          ctxRef.current.closePath();
          setIsDrawing(false);
          onSave(canvasRef.current.toDataURL());
        };

        const getCoordinates = (e) => {
          if (e.nativeEvent.offsetX !== undefined) {
            return { offsetX: e.nativeEvent.offsetX, offsetY: e.nativeEvent.offsetY };
          } else {
            const rect = canvasRef.current.getBoundingClientRect();
            const clientX = e.nativeEvent.touches ? e.nativeEvent.touches[0].clientX : e.clientX;
            const clientY = e.nativeEvent.touches ? e.nativeEvent.touches[0].clientY : e.clientY;
            return {
              offsetX: clientX - rect.left,
              offsetY: clientY - rect.top
            };
          }
        };

        const clear = () => {
          ctxRef.current.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
          onSave(null);
        };

        return React.createElement('div', { className: "flex-1 flex flex-col gap-4" }, [
          React.createElement('div', { className: "flex justify-end", key: "canvas-tools" }, 
            React.createElement('button', { 
              onClick: clear,
              className: "p-2 brutal-border bg-red-500 text-white brutal-shadow brutal-btn flex items-center gap-2 font-black uppercase text-xs"
            }, [React.createElement(RotateCcw, { className: "w-4 h-4" }), "Reset Canvas"])
          ),
          React.createElement('canvas', {
            ref: canvasRef,
            onMouseDown: startDrawing,
            onMouseMove: draw,
            onMouseUp: stopDrawing,
            onMouseOut: stopDrawing,
            onTouchStart: startDrawing,
            onTouchMove: draw,
            onTouchEnd: stopDrawing,
            className: `flex-1 w-full brutal-border brutal-shadow canvas-container ${theme === 'dark' ? 'bg-zinc-900' : 'bg-white'}`,
            key: "canvas"
          })
        ]);
      };

      const App = () => {
        // State
        const [notes, setNotes] = useState(() => {
          const saved = localStorage.getItem('notes');
          return saved ? JSON.parse(saved) : [];
        });
        const [activeId, setActiveId] = useState(() => {
          return localStorage.getItem('activeId');
        });
        const [searchQuery, setSearchQuery] = useState('');
        const [theme, setTheme] = useState(() => {
          const saved = localStorage.getItem('theme');
          return saved || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        });
        const [isSidebarOpen, setIsSidebarOpen] = useState(false);
        const [newItemText, setNewItemText] = useState('');
        const [isRecording, setIsRecording] = useState(false);
        
        const mediaRecorderRef = useRef(null);
        const audioChunksRef = useRef([]);
        const [noteToDelete, setNoteToDelete] = useState(null);

        // Refs
        const contentRef = useRef(null);
        const addItemRef = useRef(null);
        const fileInputRef = useRef(null);
        const imageInputRef = useRef(null);

        // Derived state
        const activeNote = useMemo(() => notes.find(n => n.id === activeId) || null, [notes, activeId]);
        
        const wordCount = useMemo(() => {
          if (!activeNote) return 0;
          if (activeNote.mode === 'checklist') return activeNote.items?.length || 0;
          if (activeNote.mode === 'doodle') return 0;
          const fullText = `${activeNote.title} ${activeNote.content || ''}`.trim();
          return fullText ? fullText.split(/\s+/).filter(Boolean).length : 0;
        }, [activeNote]);

        const filteredNotes = useMemo(() => {
          const sorted = [...notes].sort((a, b) => {
            if (a.pinned && !b.pinned) return -1;
            if (!a.pinned && b.pinned) return 1;
            return b.updatedAt - a.updatedAt;
          });

          if (!searchQuery.trim()) return sorted;
          const query = searchQuery.toLowerCase();
          return sorted.filter(n => 
            (n.title || '').toLowerCase().includes(query) || 
            (n.mode === 'checklist' ? (n.items || []).some(i => i.text.toLowerCase().includes(query)) : (n.content || '').toLowerCase().includes(query))
          );
        }, [notes, searchQuery]);

        // Effects
        useEffect(() => {
          localStorage.setItem('notes', JSON.stringify(notes));
        }, [notes]);

        useEffect(() => {
          if (activeId) localStorage.setItem('activeId', activeId);
          else localStorage.removeItem('activeId');
        }, [activeId]);

        useEffect(() => {
          document.documentElement.classList.toggle('dark', theme === 'dark');
          localStorage.setItem('theme', theme);
        }, [theme]);

        // Handlers
        const createNewNote = useCallback(() => {
          const newNote = {
            id: Date.now().toString(),
            title: '',
            content: '',
            mode: 'text',
            items: [],
            pinned: false,
            updatedAt: Date.now(),
            attachments: [],
            doodleData: null
          };
          setNotes(prev => [newNote, ...prev]);
          setActiveId(newNote.id);
          setIsSidebarOpen(false);
        }, []);

        const triggerDeleteNote = useCallback((id, e) => {
          if (e) e.stopPropagation();
          setNoteToDelete(id);
        }, []);

        const confirmDelete = useCallback(() => {
          if (!noteToDelete) return;
          setNotes(prev => prev.filter(n => n.id !== noteToDelete));
          if (activeId === noteToDelete) setActiveId(null);
          setNoteToDelete(null);
        }, [noteToDelete, activeId]);

        const updateNote = useCallback((id, field, value) => {
          setNotes(prev => prev.map(n => 
            n.id === id ? { ...n, [field]: value, updatedAt: Date.now() } : n
          ));
        }, []);

        const handleFileUpload = useCallback(async (e, type) => {
          const file = e.target.files[0];
          if (!file || !activeId) return;

          const reader = new FileReader();
          reader.onload = (event) => {
            const attachment = {
              id: Date.now().toString() + '-' + Math.random().toString(36).substr(2, 9),
              type,
              name: file.name,
              mimeType: file.type,
              data: event.target.result
            };
            setNotes(prev => prev.map(n => 
              n.id === activeId ? { 
                ...n, 
                attachments: [...(n.attachments || []), attachment], 
                updatedAt: Date.now() 
              } : n
            ));
            // Reset input so it triggers again for the same file if needed
            e.target.value = '';
          };
          reader.onerror = () => alert("Failed to read file.");
          reader.readAsDataURL(file);
        }, [activeId]);

        const toggleVoiceRecording = async () => {
          if (isRecording) {
            if (mediaRecorderRef.current && mediaRecorderRef.current.state !== 'inactive') {
              mediaRecorderRef.current.stop();
            }
            setIsRecording(false);
          } else {
            if (!activeId) return;
            try {
              const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
              const mediaRecorder = new MediaRecorder(stream);
              mediaRecorderRef.current = mediaRecorder;
              audioChunksRef.current = [];

              mediaRecorder.ondataavailable = (e) => {
                if (e.data.size > 0) audioChunksRef.current.push(e.data);
              };

              mediaRecorder.onstop = () => {
                const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/webm' });
                const reader = new FileReader();
                reader.onload = (e) => {
                  const attachment = {
                    id: Date.now().toString() + '-voice',
                    type: 'voice',
                    name: `Voice Clip ${new Date().toLocaleTimeString()}`,
                    mimeType: 'audio/webm',
                    data: e.target.result
                  };
                  setNotes(prev => prev.map(n => 
                    n.id === activeId ? { 
                      ...n, 
                      attachments: [...(n.attachments || []), attachment], 
                      updatedAt: Date.now() 
                    } : n
                  ));
                };
                reader.readAsDataURL(audioBlob);
                stream.getTracks().forEach(track => track.stop());
              };

              mediaRecorder.start();
              setIsRecording(true);
            } catch (err) {
              console.error("Mic access denied", err);
              alert("Could not access microphone. Ensure you have given permission.");
            }
          }
        };

        const removeAttachment = (attachmentId) => {
          setNotes(prev => prev.map(n => 
            n.id === activeId ? { 
              ...n, 
              attachments: (n.attachments || []).filter(a => a.id !== attachmentId), 
              updatedAt: Date.now() 
            } : n
          ));
        };

        const togglePin = useCallback((id, e) => {
          if (e) e.stopPropagation();
          setNotes(prev => prev.map(n => n.id === id ? { ...n, pinned: !n.pinned } : n));
        }, []);

        const toggleTheme = () => setTheme(prev => prev === 'light' ? 'dark' : 'light');

        const primaryColor = theme === 'dark' ? 'bg-[#00FF41]' : 'bg-[#FFE600]';
        const secondaryColor = theme === 'dark' ? 'bg-[#FF00F5]' : 'bg-[#FF00F5]';
        const accentColor = theme === 'dark' ? 'bg-[#3300FF]' : 'bg-[#00D1FF]';
        const surfaceColor = theme === 'dark' ? 'bg-[#121212]' : 'bg-white';

        const handleTitleKeyDown = (e) => {
          if (e.key === 'Enter') {
            e.preventDefault();
            if (activeNote.mode === 'checklist') addItemRef.current?.focus();
            else contentRef.current?.focus();
          }
        };

        const addChecklistItem = useCallback(() => {
          if (!newItemText.trim() || !activeId) return;
          const newItem = { id: Date.now().toString(), text: newItemText.trim(), completed: false };
          setNotes(prev => prev.map(n => 
            n.id === activeId ? { ...n, items: [...(n.items || []), newItem], updatedAt: Date.now() } : n
          ));
          setNewItemText('');
          addItemRef.current?.focus();
        }, [newItemText, activeId]);

        const toggleChecklistItem = (itemId) => {
          setNotes(prev => prev.map(n => 
            n.id === activeId ? { 
              ...n, 
              items: (n.items || []).map(i => i.id === itemId ? { ...i, completed: !i.completed } : i),
              updatedAt: Date.now()
            } : n
          ));
        };

        return React.createElement('div', { 
          className: `h-screen w-full relative flex flex-col overflow-hidden transition-colors duration-200 bg-grid ${theme === 'dark' ? 'bg-[#0A0A0A] text-white' : 'bg-[#F0F0F0] text-black'}`
        }, [
          // Global Hidden Inputs
          React.createElement('input', { 
            type: "file", 
            ref: fileInputRef, 
            className: "hidden", 
            onChange: (e) => handleFileUpload(e, 'file'), 
            key: "file-input" 
          }),
          React.createElement('input', { 
            type: "file", 
            ref: imageInputRef, 
            accept: "image/*", 
            className: "hidden", 
            onChange: (e) => handleFileUpload(e, 'image'), 
            key: "image-input" 
          }),

          // Header
          React.createElement('header', { 
            key: 'header',
            className: `h-20 px-6 flex items-center justify-between z-50 border-b-[4px] border-black ${theme === 'dark' ? 'bg-black' : 'bg-white'}`
          }, [
            React.createElement('div', { className: "flex items-center gap-4", key: "h-left" }, [
              React.createElement('button', { 
                onClick: () => setIsSidebarOpen(true),
                className: `md:hidden p-2 brutal-border brutal-shadow brutal-btn ${primaryColor} text-black`,
                key: "menu-btn"
              }, React.createElement(Menu, { className: "w-6 h-6" })),
              React.createElement('div', { className: "flex items-center gap-3", key: "logo-container" }, 
                React.createElement('div', { className: `p-1 brutal-border brutal-shadow ${secondaryColor} text-black h-12 w-10 flex items-center justify-center` }, 
                  React.createElement(AppLogo, { className: "w-full h-full" })
                )
              )
            ]),
            React.createElement('div', { className: "flex-1 max-w-md mx-6 hidden md:block", key: "h-search" }, 
              React.createElement('div', { className: `relative brutal-border brutal-shadow ${theme === 'dark' ? 'bg-zinc-800' : 'bg-white'}` }, [
                React.createElement(Search, { className: `absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 ${theme === 'dark' ? 'text-zinc-400' : 'text-black'}` }),
                React.createElement('input', { 
                  type: "text", 
                  placeholder: "SEARCH YOUR BRAIN...",
                  value: searchQuery,
                  onChange: (e) => setSearchQuery(e.target.value),
                  className: "w-full bg-transparent py-3 pl-12 pr-4 focus:outline-none font-bold placeholder:opacity-50"
                })
              ])
            ),
            React.createElement('div', { className: "flex items-center gap-4", key: "h-actions" }, [
              React.createElement('button', { 
                onClick: toggleTheme,
                className: `p-3 brutal-border brutal-shadow brutal-btn ${accentColor} text-black`
              }, theme === 'dark' ? React.createElement(Sun, { className: "w-6 h-6" }) : React.createElement(Moon, { className: "w-6 h-6" })),
              React.createElement('button', { 
                onClick: createNewNote,
                className: `flex items-center gap-2 ${primaryColor} text-black px-6 py-3 brutal-border brutal-shadow brutal-btn font-black uppercase text-sm`
              }, [
                React.createElement(Plus, { className: "w-6 h-6" }),
                React.createElement('span', { className: "hidden sm:inline" }, "New Note")
              ])
            ])
          ]),

          // Main Body
          React.createElement('main', { 
            className: "flex-1 flex gap-6 p-6 overflow-hidden relative",
            key: "main"
          }, [
            // Sidebar
            React.createElement('aside', { 
              className: `fixed inset-0 z-[100] md:relative md:inset-auto md:z-auto md:flex md:w-80 flex-col transition-all duration-300 ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0'}`,
              key: "sidebar"
            }, [
              React.createElement('div', { 
                className: `absolute inset-0 bg-black/80 md:hidden transition-opacity ${isSidebarOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'}`,
                onClick: () => setIsSidebarOpen(false)
              }),
              React.createElement('div', { className: `relative w-80 h-full md:w-full brutal-border brutal-shadow-lg ${surfaceColor} overflow-hidden flex flex-col z-[110]` }, [
                React.createElement('div', { className: `p-4 border-b-[3px] border-black flex items-center justify-between shrink-0 ${theme === 'dark' ? 'bg-zinc-900' : 'bg-zinc-100'}` }, [
                  React.createElement('span', { className: "font-black text-xs uppercase tracking-widest italic" }, "Notes"),
                  React.createElement('button', { onClick: () => setIsSidebarOpen(false), className: "md:hidden p-2 brutal-border bg-white text-black" }, React.createElement(ChevronLeft, { className: "w-4 h-4" }))
                ]),
                React.createElement('div', { className: "flex-1 scroll-container p-4 space-y-4" }, 
                  filteredNotes.length === 0 ? React.createElement('div', { className: "h-40 flex flex-col items-center justify-center text-center p-4" }, [
                    React.createElement('div', { className: "w-16 h-16 brutal-border bg-zinc-200 dark:bg-zinc-800 flex items-center justify-center mb-4" }, React.createElement(Search, { className: "w-8 h-8 opacity-20" })),
                    React.createElement('p', { className: "text-sm font-bold uppercase opacity-30 italic" }, "No Data Found")
                  ]) : filteredNotes.map(note => React.createElement('button', {
                    key: note.id,
                    onClick: () => { setActiveId(note.id); setIsSidebarOpen(false); },
                    className: `group w-full text-left p-4 brutal-border transition-all relative flex flex-col gap-3 ${activeId === note.id ? `${primaryColor} text-black brutal-shadow-active` : `hover:bg-zinc-100 dark:hover:bg-zinc-800 brutal-shadow`}`
                  }, [
                    React.createElement('div', { className: "flex items-start justify-between gap-3 w-full" }, [
                      React.createElement('h3', { className: "font-black text-lg truncate leading-tight uppercase flex items-center gap-2 flex-1 min-w-0" }, [
                        note.pinned && React.createElement(Pin, { className: "w-4 h-4 fill-current rotate-45 text-[#FF00F5] shrink-0" }),
                        note.mode === 'checklist' && React.createElement(ListTodo, { className: "w-4 h-4 text-blue-500 shrink-0" }),
                        note.mode === 'doodle' && React.createElement(Pencil, { className: "w-4 h-4 text-orange-500 shrink-0" }),
                        note.title || 'UNTITLED'
                      ]),
                      React.createElement('div', { className: "flex items-center gap-2 shrink-0" }, [
                        React.createElement('button', { onClick: (e) => togglePin(note.id, e), className: `p-1.5 brutal-border ${note.pinned ? 'bg-[#FF00F5] text-white' : 'opacity-0 group-hover:opacity-100 bg-white text-black'} transition-all hover:scale-110 active:scale-95` }, React.createElement(Pin, { className: "w-3.5 h-3.5" })),
                        React.createElement('button', { onClick: (e) => triggerDeleteNote(note.id, e), className: `opacity-0 group-hover:opacity-100 p-1.5 brutal-border bg-red-500 text-white transition-all hover:scale-110 active:scale-95` }, React.createElement(Trash2, { className: "w-3.5 h-3.5" }))
                      ])
                    ]),
                    React.createElement('div', { className: "flex items-center justify-between gap-2 opacity-40 text-[10px] font-black italic uppercase" }, [
                      React.createElement('div', { className: "flex items-center gap-2" }, [React.createElement(Clock, { className: "w-3 h-3" }), new Date(note.updatedAt).toLocaleDateString()]),
                      (note.attachments || []).length > 0 && React.createElement('div', { className: "flex items-center gap-1" }, [React.createElement(Paperclip, { className: "w-3 h-3" }), `${note.attachments.length}`])
                    ])
                  ]))
                )
              ])
            ]),

            // Editor
            React.createElement('div', { className: `flex-1 brutal-border brutal-shadow-lg ${surfaceColor} flex flex-col min-w-0 overflow-hidden` }, 
              !activeNote ? React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center text-center p-12 select-none" }, [
                React.createElement('div', { className: `w-32 h-44 brutal-border ${accentColor} brutal-shadow flex items-center justify-center mb-8 rotate-3 text-black` }, React.createElement(AppLogo, { className: "w-20 h-28" })),
                React.createElement('h2', { className: "text-4xl font-black uppercase italic tracking-tighter mb-4" }, "Awaiting Input"),
                React.createElement('p', { className: "text-lg font-bold opacity-30" }, "Initialize a new cell or select an existing one."),
                React.createElement('button', { onClick: createNewNote, className: `mt-10 px-8 py-4 brutal-border brutal-shadow brutal-btn ${primaryColor} text-black font-black uppercase text-xl` }, "Initialize Note")
              ]) : React.createElement('div', { className: "flex-1 flex flex-col overflow-hidden relative" }, [
                // Editor Toolbar - Refined for mobile
                React.createElement('div', { className: "px-4 md:px-12 pt-6 pb-2 flex items-center justify-between shrink-0 no-scrollbar overflow-x-auto gap-4" }, [
                  React.createElement('div', { className: "flex items-center gap-1.5 md:gap-2 shrink-0" }, [
                    React.createElement('button', { onClick: () => updateNote(activeNote.id, 'mode', 'text'), className: `p-2.5 md:p-3 brutal-border transition-all ${activeNote.mode === 'text' ? `${accentColor} text-black brutal-shadow-active` : 'bg-white text-black hover:bg-zinc-100'}`, title: "Text" }, React.createElement(Type, { className: "w-4 h-4 md:w-5 md:h-5" })),
                    React.createElement('button', { onClick: () => updateNote(activeNote.id, 'mode', 'checklist'), className: `p-2.5 md:p-3 brutal-border transition-all ${activeNote.mode === 'checklist' ? 'bg-[#FF00F5] text-white brutal-shadow-active' : 'bg-white text-black hover:bg-zinc-100'}`, title: "Checklist" }, React.createElement(ListTodo, { className: "w-4 h-4 md:w-5 md:h-5" })),
                    React.createElement('button', { onClick: () => updateNote(activeNote.id, 'mode', 'doodle'), className: `p-2.5 md:p-3 brutal-border transition-all ${activeNote.mode === 'doodle' ? 'bg-orange-500 text-white brutal-shadow-active' : 'bg-white text-black hover:bg-zinc-100'}`, title: "Doodle" }, React.createElement(Pencil, { className: "w-4 h-4 md:w-5 md:h-5" }))
                  ]),
                  React.createElement('div', { className: "flex items-center gap-1.5 md:gap-2 shrink-0" }, [
                    React.createElement('button', { onClick: () => imageInputRef.current?.click(), className: "p-2.5 md:p-3 brutal-border bg-white text-black brutal-shadow brutal-btn hover:bg-zinc-100", title: "Attach Image" }, React.createElement(ImageIcon, { className: "w-4 h-4 md:w-5 md:h-5" })),
                    React.createElement('button', { onClick: () => fileInputRef.current?.click(), className: "p-2.5 md:p-3 brutal-border bg-white text-black brutal-shadow brutal-btn hover:bg-zinc-100", title: "Attach File" }, React.createElement(Paperclip, { className: "w-4 h-4 md:w-5 md:h-5" })),
                    React.createElement('button', { 
                      onClick: toggleVoiceRecording, 
                      className: `p-2.5 md:p-3 brutal-border transition-all brutal-shadow brutal-btn ${isRecording ? 'bg-red-500 text-white animate-pulse' : 'bg-white text-black hover:bg-zinc-100'}`,
                      title: isRecording ? "Stop Recording" : "Voice Note"
                    }, isRecording ? React.createElement(Square, { className: "w-4 h-4 md:w-5 md:h-5" }) : React.createElement(Mic, { className: "w-4 h-4 md:w-5 md:h-5" }))
                  ])
                ]),
                
                // Editor Content
                React.createElement('div', { className: "flex-1 flex flex-col px-6 md:px-12 pb-8 scroll-container" }, [
                  React.createElement('div', { className: "flex flex-col gap-4 h-full" }, [
                    React.createElement('input', {
                      className: "w-full bg-transparent text-3xl md:text-5xl font-black uppercase placeholder:opacity-20 focus:outline-none tracking-tighter shrink-0",
                      placeholder: "ENTER TITLE...",
                      value: activeNote.title,
                      onChange: (e) => updateNote(activeNote.id, 'title', e.target.value),
                      onKeyDown: handleTitleKeyDown
                    }),
                    React.createElement('div', { className: "h-1 w-24 bg-black dark:bg-white shrink-0" }),
                    
                    activeNote.mode === 'doodle' ? 
                      React.createElement(DoodleCanvas, { 
                        initialData: activeNote.doodleData, 
                        onSave: (data) => updateNote(activeNote.id, 'doodleData', data),
                        theme: theme
                      }) :
                    activeNote.mode === 'checklist' ? 
                      React.createElement('div', { className: "flex flex-col gap-6" }, [
                        React.createElement('div', { className: "flex gap-2" }, [
                          React.createElement('input', {
                            ref: addItemRef,
                            type: "text",
                            placeholder: "ADD TASK...",
                            value: newItemText,
                            onChange: (e) => setNewItemText(e.target.value),
                            onKeyDown: (e) => e.key === 'Enter' && addChecklistItem(),
                            className: `flex-1 brutal-border brutal-shadow p-4 font-black uppercase text-sm ${theme === 'dark' ? 'bg-zinc-800' : 'bg-white'}`
                          }),
                          React.createElement('button', { onClick: addChecklistItem, className: `px-6 brutal-border brutal-shadow brutal-btn ${primaryColor} text-black font-black uppercase text-sm` }, "ADD")
                        ]),
                        React.createElement('div', { className: "flex flex-col gap-3 pr-2" }, (activeNote.items || []).map(item => React.createElement('div', { key: item.id, className: `flex items-center gap-4 p-4 brutal-border brutal-shadow ${theme === 'dark' ? 'bg-zinc-900' : 'bg-white'} group` }, [
                          React.createElement('input', { type: "checkbox", checked: item.completed, onChange: () => toggleChecklistItem(item.id), className: "custom-checkbox shrink-0" }),
                          React.createElement('span', { className: `flex-1 font-bold text-lg ${item.completed ? 'line-through opacity-40' : ''}` }, item.text),
                          React.createElement('button', { onClick: () => updateNote(activeNote.id, 'items', activeNote.items.filter(i => i.id !== item.id)), className: "opacity-0 group-hover:opacity-100 p-2 brutal-border bg-red-500 text-white" }, React.createElement(X, { className: "w-4 h-4" }))
                        ])))
                      ]) :
                      React.createElement('textarea', {
                        ref: contentRef,
                        className: "flex-1 w-full bg-transparent text-lg md:text-xl font-medium leading-relaxed placeholder:opacity-20 focus:outline-none resize-none min-h-[300px]",
                        placeholder: "WRITE YOUR MESSAGE TO THE VOID...",
                        value: activeNote.content || '',
                        onChange: (e) => updateNote(activeNote.id, 'content', e.target.value)
                      }),

                    // Attachments List
                    ((activeNote.attachments || []).length > 0) && React.createElement('div', { className: "mt-8 border-t-[3px] border-black pt-6 flex flex-col gap-4" }, [
                      React.createElement('h4', { className: "font-black italic uppercase text-xs" }, "Attachments"),
                      React.createElement('div', { className: "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" }, 
                        activeNote.attachments.map(att => React.createElement('div', { key: att.id, className: "brutal-border brutal-shadow bg-white text-black p-3 flex flex-col gap-2 relative group" }, [
                          React.createElement('button', { 
                            onClick: () => removeAttachment(att.id), 
                            className: "absolute -top-2 -right-2 p-1 bg-red-500 border-2 border-black text-white rounded-none opacity-0 group-hover:opacity-100 transition-opacity z-10",
                            title: "Remove"
                          }, React.createElement(X, { className: "w-4 h-4" })),
                          att.type === 'image' ? 
                            React.createElement('img', { src: att.data, className: "w-full h-32 object-cover brutal-border mb-1" }) :
                          att.type === 'voice' ?
                            React.createElement('div', { className: "flex flex-col gap-2 p-2 bg-[#FFE600] brutal-border" }, [
                              React.createElement('div', { className: "flex items-center gap-2" }, [
                                React.createElement(Music, { className: "w-4 h-4" }),
                                React.createElement('span', { className: "text-[10px] font-black uppercase truncate" }, att.name)
                              ]),
                              React.createElement('audio', { src: att.data, controls: true, className: "w-full h-10" })
                            ]) :
                            React.createElement('div', { className: "flex items-center gap-3 p-2 bg-[#00D1FF] brutal-border" }, [
                              React.createElement(FileText, { className: "w-6 h-6 shrink-0" }),
                              React.createElement('span', { className: "text-xs font-black truncate flex-1 uppercase" }, att.name),
                              React.createElement('a', { href: att.data, download: att.name, className: "p-1 brutal-border bg-white hover:bg-zinc-100" }, React.createElement(Download, { className: "w-4 h-4" }))
                            ])
                        ]))
                      )
                    ])
                  ])
                ]),

                // Footer
                React.createElement('div', { className: "mt-auto px-6 md:px-12 pt-6 pb-6 border-t-[3px] border-black dark:border-zinc-800 flex flex-wrap items-center justify-between gap-4 font-black italic text-xs uppercase" }, [
                  React.createElement('div', { className: "flex items-center gap-3" }, [
                    React.createElement('div', { className: `px-4 py-2 brutal-border ${accentColor} text-black brutal-shadow` }, 
                      activeNote.mode === 'checklist' ? `${(activeNote.items || []).length} TASKS` : activeNote.mode === 'doodle' ? 'DOODLE' : `${wordCount} WORDS`
                    ),
                    activeNote.pinned && React.createElement('div', { className: "px-4 py-2 brutal-border bg-[#FF00F5] text-white brutal-shadow flex items-center gap-2" }, [React.createElement(Pin, { className: "w-3 h-3 fill-current" }), "PINNED"])
                  ]),
                  React.createElement('div', { className: "flex items-center gap-3 opacity-60" }, [React.createElement(Clock, { className: "w-4 h-4" }), `STAMPED: ${new Date(activeNote.updatedAt).toLocaleString()}`])
                ])
              ])
            )
          ]),

          // Global Footer
          React.createElement('footer', { className: `h-12 border-t-[4px] border-black px-8 flex items-center justify-center text-[11px] font-black italic uppercase tracking-[0.3em] ${theme === 'dark' ? 'bg-black text-[#00FF41]' : 'bg-white text-black'}` }, "Everything saves automatically."),

          // Delete Modal
          noteToDelete && React.createElement('div', { className: "fixed inset-0 z-[200] flex items-center justify-center p-6 bg-black/90 backdrop-blur-sm", onClick: () => setNoteToDelete(null) }, 
            React.createElement('div', { className: "bg-[#FFE600] text-black brutal-border brutal-shadow-lg p-10 max-w-md w-full modal-animate relative", onClick: (e) => e.stopPropagation() }, [
              React.createElement('div', { className: "flex flex-col items-center text-center" }, [
                React.createElement('div', { className: "p-4 bg-red-500 brutal-border brutal-shadow mb-6 rotate-3" }, React.createElement(AlertTriangle, { className: "w-12 h-12 text-white" })),
                React.createElement('h2', { className: "text-4xl font-black uppercase italic tracking-tighter mb-4 leading-none" }, "CRITICAL ACTION"),
                React.createElement('p', { className: "text-xl font-bold mb-10 leading-tight uppercase" }, "PERMANENTLY ERASE THIS DATA FROM THE SYSTEM?"),
                React.createElement('div', { className: "flex flex-col sm:flex-row gap-4 w-full" }, [
                  React.createElement('button', { className: "flex-1 py-4 brutal-border brutal-shadow brutal-btn bg-black text-white font-black uppercase tracking-widest text-sm", onClick: () => setNoteToDelete(null) }, "NO, KEEP IT"),
                  React.createElement('button', { className: "flex-1 py-4 brutal-border brutal-shadow brutal-btn bg-red-500 text-white font-black uppercase tracking-widest text-sm", onClick: confirmDelete }, "YES, ERASE IT")
                ])
              ])
            ])
          )
        ]);
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(React.createElement(App));
    </script>
</body>
</html>
