<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Minimal Notes â€“ Full Working App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root {
  --bg: #ffffff;
  --bg-secondary: #fbfbfc;
  --bg-hover: #ececee;
  --bg-active: #e0e0e5;
  --border: #e5e5e7;
  --text: #1c1c1e;
  --text-muted: #8e8e93;
  --input-bg: #f9f9fa;
}

body.dark {
  --bg: #1c1c1e;
  --bg-secondary: #2c2c2e;
  --bg-hover: #3a3a3c;
  --bg-active: #48484a;
  --border: #3a3a3c;
  --text: #f2f2f7;
  --text-muted: #a1a1a6;
  --input-bg: #2c2c2e;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
  background: #888;
  height: 100vh;
  color: var(--text);
}

/* ===== App ===== */
.app {
  height: 100vh;
  max-width: 1200px;
  margin: 0 auto;
  background: var(--bg);
  display: flex;
  flex-direction: column;
}

/* ===== Top Bar ===== */
.topbar {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  border-bottom: 1px solid var(--border);
}

.search {
  flex: 1;
  padding: 6px 8px;
  font-size: 14px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: var(--input-bg);
  color: var(--text);
}

.btn {
  padding: 6px 10px;
  font-size: 14px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: var(--input-bg);
  color: var(--text);
  cursor: pointer;
}

/* ===== Layout ===== */
.main {
  display: flex;
  flex: 1;
  min-height: 0;
}

/* ===== Notes List ===== */
.list {
  width: 28%;
  border-right: 1px solid var(--border);
  padding: 6px;
  overflow-y: auto;
  background: var(--bg-secondary);
}

.note {
  position: relative;
  border-radius: 6px;
  margin-bottom: 2px;
  overflow: hidden; /* clip swipe background */
}

.note .swipe-bg {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  background: #ff3b30; /* red delete */
  display: flex;
  align-items: center;
  justify-content: flex-end;
  padding-right: 12px;
  color: #fff;
  font-weight: bold;
  z-index: 0;
  border-radius: 6px;
}

.note > div:nth-child(2) {
  position: relative;
  z-index: 1;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--bg-secondary); /* ensures normal notes are neutral */
  padding: 8px 10px;
  font-size: 14px;
  cursor: pointer;
  border-radius: 6px;
  transition: background 0.2s;
}

.note.active > div:nth-child(2) { background: var(--bg-active); font-weight: 500; }
.note:hover > div:nth-child(2) { background: var(--bg-hover); }


.delete-btn {
  opacity: 0;
  border: none;
  background: transparent;
  cursor: pointer;
  font-size: 14px;
  color: var(--text-muted);
}

.note:hover .delete-btn { opacity: 1; }
.delete-btn:hover { color: var(--text); }

/* ===== Editor ===== */
.editor {
  flex: 1;
  padding: 16px 20px;
  display: flex;
  flex-direction: column;
}

#editor {
  flex: 1;
  outline: none;
  font-size: 16px;
  line-height: 1.6;
  white-space: pre-wrap;
  color: var(--text);
  font-family: inherit;
}

/* First line styled as title */
#editor > div:first-child {
  font-size: 20px;
  font-weight: 600;
  line-height: 1.3;
  margin-bottom: 8px;
}

/* Placeholder */
#editor:empty:before {
  content: attr(data-placeholder);
  color: var(--text-muted);
}

.hint {
  font-size: 13px;
  color: var(--text-muted);
  margin-top: 6px;
}

/* ===== Mobile ===== */
@media (max-width: 768px) {
  .main { flex-direction: column; }
  .list {
    width: 100%;
    border-right: none;
    border-bottom: 1px solid var(--border);
  }
}

/* ===== Undo Toast ===== */
#undoToast {
  position: fixed;
  bottom: 16px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--bg-secondary);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 8px 12px;
  display: none;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  z-index: 1000;
}

#undoBtn {
  border: none;
  background: transparent;
  color: #007aff;
  cursor: pointer;
  font-weight: bold;
}
</style>
</head>

<body>
<div class="app">
  <!-- Top Bar -->
  <div class="topbar">
    <input class="search" placeholder="Searchâ€¦" />
    <button class="btn" id="toggleTheme">ðŸŒ™</button>
    <button class="btn" id="newNote">ï¼‹</button>
  </div>

  <!-- Main -->
  <div class="main">
    <div class="list" id="noteList"></div>

    <div class="editor">
      <div id="editor" contenteditable="true" spellcheck="false" data-placeholder="Start typingâ€¦"></div>
      <div class="hint">Everything saves automatically</div>
    </div>
  </div>
</div>

<!-- Undo Toast -->
<div id="undoToast">
  Note deleted
  <button id="undoBtn">Undo</button>
</div>

<script>
const noteList = document.getElementById("noteList");
const editor = document.getElementById("editor");
const search = document.querySelector(".search");
const newBtn = document.getElementById("newNote");
const themeBtn = document.getElementById("toggleTheme");
const undoToast = document.getElementById("undoToast");
const undoBtn = document.getElementById("undoBtn");

let notes = JSON.parse(localStorage.getItem("notes")) || [];
let activeId = localStorage.getItem("activeId");
let theme = localStorage.getItem("theme") || "light";
let lastDeleted = null;

/* ===== Theme ===== */
function applyTheme() {
  document.body.classList.toggle("dark", theme === "dark");
  themeBtn.textContent = theme === "dark" ? "â˜€ï¸Ž" : "ðŸŒ™";
  localStorage.setItem("theme", theme);
}
themeBtn.onclick = () => { theme = theme === "dark" ? "light" : "dark"; applyTheme(); };
applyTheme();

/* ===== Notes Storage ===== */
function saveNotes() {
  localStorage.setItem("notes", JSON.stringify(notes));
  localStorage.setItem("activeId", activeId);
}

/* ===== Caret Helpers ===== */
function placeCaretAtStart(el) {
  el.focus();
  const range = document.createRange();
  range.selectNodeContents(el);
  range.collapse(true);
  const sel = window.getSelection();
  sel.removeAllRanges();
  sel.addRange(range);
}
function placeCaretAtEnd(el) {
  el.focus();
  const range = document.createRange();
  range.selectNodeContents(el);
  range.collapse(false);
  const sel = window.getSelection();
  sel.removeAllRanges();
  sel.addRange(range);
}

/* ===== Swipe Listeners ===== */
function addSwipeListeners(noteEl, noteId) {
  let startX = 0;
  let currentX = 0;
  let swiping = false;
  const content = noteEl.querySelector("div:nth-child(2)");

  noteEl.addEventListener("touchstart", e => {
    startX = e.touches[0].clientX;
    swiping = true;
    noteEl.classList.add("swiping");
  });

  noteEl.addEventListener("touchmove", e => {
    if(!swiping) return;
    currentX = e.touches[0].clientX;
    const dx = currentX - startX;
    if(dx < 0) content.style.transform = `translateX(${dx}px)`;
  });

  noteEl.addEventListener("touchend", e => {
    swiping = false;
    noteEl.classList.remove("swiping");
    const dx = currentX - startX;
    if(dx < -100) deleteNote(noteId);
    else content.style.transform = "translateX(0)";
  });
}

/* ===== Render Notes ===== */
function renderNotes(filter = "") {
  noteList.innerHTML = "";
  const lowerFilter = filter.toLowerCase();

  notes.forEach(note => {
    if(filter && !note.text.toLowerCase().includes(lowerFilter)) return;

    const el = document.createElement("div");
    el.className = "note" + (note.id === activeId ? " active" : "");

    const bg = document.createElement("div");
    bg.className = "swipe-bg";
    bg.textContent = "Delete";
    el.appendChild(bg);

    const content = document.createElement("div");
    content.style.position = "relative";
    content.style.zIndex = 1;
    content.style.display = "flex";
    content.style.justifyContent = "space-between";
    content.style.alignItems = "center";

    let previewText = note.text.split("\n")[0] || "Untitled";

    if(filter) {
      const lowerText = note.text.toLowerCase();
      const matchIndex = lowerText.indexOf(lowerFilter);
      if(matchIndex >=0) {
        const start = Math.max(0, matchIndex-20);
        const end = Math.min(note.text.length, matchIndex + lowerFilter.length + 30);
        let snippet = note.text.substring(start, end);
        if(start>0) snippet = "â€¦" + snippet;
        if(end<note.text.length) snippet = snippet + "â€¦";
        const regex = new RegExp(`(${filter.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`,"gi");
        snippet = snippet.replace(regex,"<mark>$1</mark>");
        previewText = snippet;
      }
    }

    const title = document.createElement("span");
    title.innerHTML = previewText;
    title.style.flex="1";
    title.style.fontSize="14px";

    const del = document.createElement("button");
    del.className = "delete-btn";
    del.textContent = "ðŸ—‘";
    del.onclick = e => { e.stopPropagation(); deleteNote(note.id); };

    content.appendChild(title);
    content.appendChild(del);
    el.appendChild(content);

    el.onclick = () => selectNote(note.id);
    addSwipeListeners(el, note.id);

    noteList.appendChild(el);
  });
}

/* ===== Select, Create, Delete ===== */
function selectNote(id) {
  activeId = id;
  const note = notes.find(n => n.id===id);
  editor.innerHTML = note.text.split("\n").map(line => `<div>${line||"<br>"}</div>`).join("");
  renderNotes(search.value);
  saveNotes();
  placeCaretAtEnd(editor);
}

function createNote() {
  const note = {id:Date.now().toString(), text:""};
  notes.unshift(note);
  activeId = note.id;
  editor.innerHTML = "<div><br></div>";
  renderNotes(search.value);
  saveNotes();
  placeCaretAtEnd(editor);
}

function deleteNote(id) {
  const index = notes.findIndex(n=>n.id===id);
  if(index===-1) return;

  lastDeleted = { note: notes[index], index };
  notes.splice(index,1);

  undoToast.style.display="flex";
  setTimeout(()=>{ if(lastDeleted) undoToast.style.display="none"; },5000);

  if(activeId===id){
    if(notes.length>0) selectNote(notes[0].id);
    else createNote();
  } else { saveNotes(); renderNotes(search.value); }
}

/* ===== Undo ===== */
undoBtn.onclick = () => {
  if(lastDeleted){
    notes.splice(lastDeleted.index,0,lastDeleted.note);
    activeId = lastDeleted.note.id;
    renderNotes(search.value);
    selectNote(activeId);
    lastDeleted = null;
    undoToast.style.display="none";
    saveNotes();
  }
}

/* ===== Editor Input ===== */
editor.addEventListener("input", () => {
  const divs = editor.querySelectorAll("div");
  divs.forEach((div,i)=>{ if(i>0) div.style=""; });
  const note = notes.find(n=>n.id===activeId);
  if(note){
    note.text = Array.from(divs).map(d=>d.innerText).join("\n");
    saveNotes();
    renderNotes(search.value);
  }
});

editor.addEventListener("keypress", e => {
  if(e.key==="Enter"){
    setTimeout(()=>{
      const divs = editor.querySelectorAll("div");
      divs.forEach((div,i)=>{ if(i>0) div.style=""; });
    },0);
  }
});

/* ===== Search & New Note ===== */
search.addEventListener("input", ()=>renderNotes(search.value));
newBtn.onclick = createNote;

/* ===== Init ===== */
if(notes.length===0) createNote();
else selectNote(activeId || notes[0].id);
</script>
</body>
</html>
